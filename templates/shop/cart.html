{% extends 'base.html' %}
{% load static %}

{% block title %}Shopping Cart - Watercolors By Karla{% endblock title %}

{% block content %}

<!-- Valentine's Shop Banner -->
<div class="valentine-banner" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); padding: 1rem; text-align: center; border-bottom: 2px solid #ff6b9d;">
  <p style="margin: 0; color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; font-size: clamp(1rem, 2vw, 1.3rem);">
    üíï <strong>Your Shopping Cart</strong> üíï
  </p>
</div>

<div class="container my-5">
  <!-- Messages -->
  {% if messages %}
  <div class="mb-4">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="row">
    <!-- Cart Items -->
    <div class="col-lg-8 mb-4">
      <div class="card shadow-lg" style="border: 2px solid #ffb3ba;">
        <div class="card-header" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-bottom: 2px solid #ff6b9d;">
          <h3 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; margin: 0;">
            üõçÔ∏è Cart Items ({{ cart.get_item_count }})
          </h3>
        </div>
        <div class="card-body">
          {% if cart.items.all %}
            {% for item in cart.items.all %}
            <div class="row mb-4 pb-4 border-bottom" style="border-color: #ffb3ba !important;">
              <!-- Product Image -->
              <div class="col-md-3">
                {% if item.print_size.product.image %}
                  <img src="{{ item.print_size.product.image.url }}" alt="{{ item.print_size.product.name }}" class="img-fluid rounded" style="border: 2px solid #ffb3ba;">
                {% else %}
                  <div class="d-flex align-items-center justify-content-center rounded" style="border: 2px solid #ffb3ba; height: 150px; background: linear-gradient(135deg, #ffe4e6 0%, #ffc9d4 100%);">
                    <span style="font-size: 3rem; color: #ff6b9d;">üé®</span>
                  </div>
                {% endif %}
              </div>
              
              <!-- Product Details -->
              <div class="col-md-5">
                <h5 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">
                  {{ item.print_size.product.name }}
                </h5>
                <p class="text-muted mb-1">
                  <strong>Size:</strong> {{ item.print_size.get_size_display }}
                </p>
                <p style="color: #c94b7d; font-weight: bold;">
                  ${{ item.print_size.price }} each
                </p>
              </div>
              
              <!-- Quantity & Actions -->
              <div class="col-md-4 text-end">
                <form method="POST" action="{% url 'shop:update_cart_item' item.id %}" class="d-inline">
                  {% csrf_token %}
                  <div class="input-group mb-2" style="max-width: 120px; float: right;">
                    <button class="btn btn-outline-secondary" type="button" onclick="decrementQty({{ item.id }})">-</button>
                    <input type="number" class="form-control text-center" name="quantity" id="qty-{{ item.id }}" value="{{ item.quantity }}" min="1" max="10">
                    <button class="btn btn-outline-secondary" type="button" onclick="incrementQty({{ item.id }})">+</button>
                  </div>
                  <button type="submit" class="btn btn-sm btn-outline-success mb-2" style="float: right; clear: right;">Update</button>
                </form>
                
                <form method="POST" action="{% url 'shop:remove_from_cart' item.id %}" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger" style="float: right; clear: right;">Remove</button>
                </form>
                
                <div style="clear: both; margin-top: 1rem;">
                  <strong style="color: #8b0000; font-size: 1.2rem;">
                    Subtotal: ${{ item.get_subtotal }}
                  </strong>
                </div>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <!-- Empty Cart -->
            <div class="text-center py-5">
              <h4 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">
                Your cart is empty
              </h4>
              <p class="text-muted mb-4">Add some beautiful prints to your cart!</p>
              <a href="{% url 'shop:shop_home' %}" class="btn btn-lg valentine-btn" style="color: white; background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); border: none;">
                Continue Shopping
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-lg-4">
      <div class="card shadow-lg" style="border: 2px solid #ffb3ba;">
        <div class="card-header" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-bottom: 2px solid #ff6b9d;">
          <h4 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; margin: 0;">
            Order Summary
          </h4>
        </div>
        <div class="card-body">
          {% if cart.items.all %}
            <div class="d-flex justify-content-between mb-2">
              <span>Subtotal:</span>
              <strong>${{ cart.get_total }}</strong>
            </div>
            <div class="d-flex justify-content-between mb-2 text-muted">
              <span>Shipping:</span>
              <span>Calculated at checkout</span>
            </div>
            <hr style="border-color: #ffb3ba;">
            <div class="d-flex justify-content-between mb-4">
              <strong style="font-size: 1.2rem;">Estimated Total:</strong>
              <strong style="font-size: 1.2rem; color: #c94b7d;">${{ cart.get_total }}</strong>
            </div>
            
            <a href="{% url 'shop:checkout' %}" class="btn btn-lg valentine-btn w-100 mb-3" style="color: white; background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); border: none;">
              üíù Proceed to Checkout
            </a>
            
            <a href="{% url 'shop:shop_home' %}" class="btn btn-outline-secondary w-100">
              Continue Shopping
            </a>
            
            <div class="mt-4 text-center" style="font-size: 0.85rem; color: #666;">
              <p>üîí Secure checkout</p>
              <p>üì¶ Ships within 5-7 business days</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function incrementQty(itemId) {
  const input = document.getElementById('qty-' + itemId);
  if (parseInt(input.value) < 10) {
    input.value = parseInt(input.value) + 1;
  }
}

function decrementQty(itemId) {
  const input = document.getElementById('qty-' + itemId);
  if (parseInt(input.value) > 1) {
    input.value = parseInt(input.value) - 1;
  }
}
</script>

<style>
  .valentine-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 16px rgba(255, 107, 157, 0.4);
    transition: all 0.3s ease;
  }
</style>

{% endblock %}