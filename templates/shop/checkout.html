{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - Watercolors By Karla{% endblock title %}

{% block content %}

<!-- Valentine's Shop Banner -->
<div class="valentine-banner" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); padding: 1rem; text-align: center; border-bottom: 2px solid #ff6b9d;">
  <p style="margin: 0; color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; font-size: clamp(1rem, 2vw, 1.3rem);">
    üíï <strong>Secure Checkout</strong> üíï
  </p>
</div>

<div class="container my-5">
  <div class="row">
    <!-- Checkout Form -->
    <div class="col-lg-7 mb-4">
      <div class="card shadow-lg" style="border: 2px solid #ffb3ba;">
        <div class="card-header" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-bottom: 2px solid #ff6b9d;">
          <h3 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; margin: 0;">
            Shipping Information
          </h3>
        </div>
        <div class="card-body p-4">
          <form method="POST" id="checkout-form">
            {% csrf_token %}
            
            <!-- Contact Information -->
            <h5 style="color: #8b0000; margin-bottom: 1rem;">Contact Details</h5>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="first_name" class="form-label">First Name *</label>
                <input type="text" class="form-control" id="first_name" name="first_name" required style="border-color: #ffb3ba;">
              </div>
              <div class="col-md-6">
                <label for="last_name" class="form-label">Last Name *</label>
                <input type="text" class="form-control" id="last_name" name="last_name" required style="border-color: #ffb3ba;">
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="email" class="form-label">Email *</label>
                <input type="email" class="form-control" id="email" name="email" required style="border-color: #ffb3ba;">
              </div>
              <div class="col-md-6">
                <label for="phone" class="form-label">Phone</label>
                <input type="tel" class="form-control" id="phone" name="phone" style="border-color: #ffb3ba;">
              </div>
            </div>

            <hr style="border-color: #ffb3ba; margin: 2rem 0;">

            <!-- Shipping Address -->
            <h5 style="color: #8b0000; margin-bottom: 1rem;">Shipping Address</h5>
            <div class="mb-3">
              <label for="address" class="form-label">Street Address *</label>
              <input type="text" class="form-control" id="address" name="address" required style="border-color: #ffb3ba;">
            </div>
            
            <div class="mb-3">
              <label for="address_line_2" class="form-label">Apartment, suite, etc. (optional)</label>
              <input type="text" class="form-control" id="address_line_2" name="address_line_2" style="border-color: #ffb3ba;">
            </div>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="city" class="form-label">City *</label>
                <input type="text" class="form-control" id="city" name="city" required style="border-color: #ffb3ba;">
              </div>
              <div class="col-md-3">
                <label for="state" class="form-label">State *</label>
                <input type="text" class="form-control" id="state" name="state" required style="border-color: #ffb3ba;" placeholder="AZ">
              </div>
              <div class="col-md-3">
                <label for="zip_code" class="form-label">ZIP Code *</label>
                <input type="text" class="form-control" id="zip_code" name="zip_code" required style="border-color: #ffb3ba;">
              </div>
            </div>

            <div class="mb-3">
              <label for="country" class="form-label">Country *</label>
              <select class="form-select" id="country" name="country" required style="border-color: #ffb3ba;">
                <option value="US" selected>United States</option>
                <option value="CA">Canada</option>
              </select>
            </div>

            <hr style="border-color: #ffb3ba; margin: 2rem 0;">

            <!-- Order Notes -->
            <h5 style="color: #8b0000; margin-bottom: 1rem;">Order Notes (Optional)</h5>
            <div class="mb-3">
              <textarea class="form-control" id="customer_notes" name="customer_notes" rows="3" placeholder="Any special instructions for your order..." style="border-color: #ffb3ba;"></textarea>
            </div>

          </form>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-lg-5">
      <div class="card shadow-lg sticky-top" style="border: 2px solid #ffb3ba; top: 20px;">
        <div class="card-header" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-bottom: 2px solid #ff6b9d;">
          <h4 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; margin: 0;">
            Order Summary
          </h4>
        </div>
        <div class="card-body">
          <!-- Cart Items -->
          {% for item in cart.items.all %}
          <div class="d-flex mb-3 pb-3 border-bottom" style="border-color: #ffb3ba !important;">
            <img src="{{ item.variant.product.image_url }}" alt="{{ item.variant.product.name }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #ffb3ba;">
            <div class="ms-3 flex-grow-1">
              <h6 style="color: #8b0000; margin: 0;">{{ item.variant.product.name }}</h6>
              <small class="text-muted">{{ item.variant.size }} - {{ item.variant.paper_type }}</small>
              <br>
              <small class="text-muted">Qty: {{ item.quantity }}</small>
            </div>
            <div class="text-end">
              <strong style="color: #c94b7d;">${{ item.get_subtotal }}</strong>
            </div>
          </div>
          {% endfor %}

          <hr style="border-color: #ffb3ba;">

          <!-- Totals -->
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <strong>${{ subtotal }}</strong>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <strong>${{ shipping_cost }}</strong>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Tax:</span>
            <strong>${{ tax }}</strong>
          </div>
          
          <hr style="border-color: #ffb3ba;">
          
          <div class="d-flex justify-content-between mb-4">
            <strong style="font-size: 1.3rem;">Total:</strong>
            <strong style="font-size: 1.3rem; color: #c94b7d;" id="total-amount">${{ total }}</strong>
          </div>

          <button type="submit" form="checkout-form" class="btn btn-lg valentine-btn w-100 mb-3" style="color: white; background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); border: none;">
            üíù Continue to Payment
          </button>

          <a href="{% url 'shop:view_cart' %}" class="btn btn-outline-secondary w-100">
            ‚Üê Back to Cart
          </a>

          <div class="mt-4 text-center" style="font-size: 0.85rem; color: #666;">
            <p>üîí Secure SSL Encryption</p>
            <p>üì¶ Ships within 5-7 business days</p>
            <p>üíØ Satisfaction Guaranteed</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .valentine-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 16px rgba(255, 107, 157, 0.4);
    transition: all 0.3s ease;
  }

  @media (min-width: 992px) {
    .sticky-top {
      position: sticky;
      top: 20px;
    }
  }
</style>

{% endblock %}