{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Watercolors By Karla{% endblock title %}

{% block content %}

<!-- Valentine's Shop Banner -->
<div class="valentine-banner" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); padding: 1rem; text-align: center; border-bottom: 2px solid #ff6b9d;">
  <p style="margin: 0; color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; font-size: clamp(1rem, 2vw, 1.3rem);">
    üíï <a href="{% url 'shop:home' %}" style="color: #8b0000; text-decoration: underline;">‚Üê Back to Shop</a>
  </p>
</div>

<div class="container my-5">
  <div class="row">
    <!-- Product Image -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-lg" style="border: 3px solid #ffb3ba;">
        <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}" style="width: 100%; height: auto;">
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-6">
      <div class="card shadow-lg" style="border: 2px solid #ffb3ba;">
        <div class="card-body p-4">
          <!-- Title -->
          <h1 style="font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; color: #8b0000; margin-bottom: 1rem;">
            {{ product.name }}
          </h1>

          <!-- Category Badge -->
          <span class="badge mb-3" style="background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); font-size: 1rem;">
            {{ product.get_category_display }}
          </span>

          <!-- Description -->
          <p style="font-size: 1.1rem; color: #666; margin-bottom: 2rem;">
            {{ product.description }}
          </p>

          <hr style="border-color: #ffb3ba;">

          <!-- Variant Selection Form -->
          {% if variants %}
          <form method="POST" action="" id="add-to-cart-form">
            {% csrf_token %}
            
            <h4 style="color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; margin-bottom: 1rem;">
              Select Size & Type:
            </h4>

            <!-- Variant Options -->
            <div class="variant-options mb-4">
              {% for variant in variants %}
              <div class="form-check variant-option mb-3 p-3" style="border: 2px solid #ffb3ba; border-radius: 8px; cursor: pointer;" data-variant-id="{{ variant.id }}" data-price="{{ variant.price }}">
                <input class="form-check-input" type="radio" name="variant_id" id="variant{{ variant.id }}" value="{{ variant.id }}" {% if forloop.first %}checked{% endif %} required>
                <label class="form-check-label w-100" for="variant{{ variant.id }}" style="cursor: pointer;">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <strong style="color: #8b0000; font-size: 1.1rem;">{{ variant.size }}</strong>
                      <br>
                      <span class="text-muted" style="font-size: 0.9rem;">{{ variant.paper_type }}</span>
                    </div>
                    <div>
                      <span style="color: #c94b7d; font-size: 1.3rem; font-weight: bold;">
                        ${{ variant.price }}
                      </span>
                    </div>
                  </div>
                </label>
              </div>
              {% endfor %}
            </div>

            <!-- Quantity -->
            <div class="mb-4">
              <label for="quantity" style="color: #8b0000; font-weight: bold; margin-bottom: 0.5rem;">Quantity:</label>
              <input type="number" class="form-control" id="quantity" name="quantity" value="1" min="1" max="10" style="border: 2px solid #ffb3ba; max-width: 100px;">
            </div>

            <!-- Selected Price Display -->
            <div class="alert" style="background: linear-gradient(135deg, #fff0f3 0%, #ffe3e9 100%); border: 2px solid #ffb3ba;">
              <h4 style="color: #8b0000; margin-bottom: 0;">
                Total: $<span id="total-price">{{ variants.0.price }}</span>
              </h4>
            </div>

            <!-- Add to Cart Button -->
            <button type="submit" class="btn btn-lg valentine-btn w-100 mb-3" style="color: white; background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); border: none; padding: 1rem; font-size: 1.2rem;">
              üíù Add to Cart
            </button>
          </form>

          {% else %}
          <!-- No Variants Available -->
          <div class="alert alert-warning">
            <strong>Out of Stock</strong>
            <p>This product is currently unavailable. Please check back later!</p>
          </div>
          {% endif %}

          <!-- Additional Info -->
          <div class="mt-4" style="font-size: 0.9rem; color: #666;">
            <p><strong>üì¶ Shipping:</strong> Ships within 5-7 business days</p>
            <p><strong>üé® Quality:</strong> Premium quality prints on professional paper</p>
            <p><strong>üíå Care:</strong> Frame under glass to preserve colors</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for Price Calculation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('add-to-cart-form');
  const quantityInput = document.getElementById('quantity');
  const totalPriceSpan = document.getElementById('total-price');
  const variantOptions = document.querySelectorAll('.variant-option');
  
  // Update form action when variant changes
  function updatePrice() {
    const selectedVariant = document.querySelector('input[name="variant_id"]:checked');
    if (selectedVariant) {
      const price = parseFloat(selectedVariant.closest('.variant-option').dataset.price);
      const quantity = parseInt(quantityInput.value);
      const total = (price * quantity).toFixed(2);
      totalPriceSpan.textContent = total;
      
      // Update form action
      form.action = "{% url 'shop:add_to_cart' 0 %}".replace('0', selectedVariant.value);
    }
  }
  
  // Highlight selected variant
  function updateVariantHighlight() {
    variantOptions.forEach(option => {
      const radio = option.querySelector('input[type="radio"]');
      if (radio.checked) {
        option.style.borderColor = '#ff6b9d';
        option.style.background = 'linear-gradient(135deg, #fff0f3 0%, #ffe3e9 100%)';
      } else {
        option.style.borderColor = '#ffb3ba';
        option.style.background = 'white';
      }
    });
  }
  
  // Event listeners
  document.querySelectorAll('input[name="variant_id"]').forEach(radio => {
    radio.addEventListener('change', function() {
      updatePrice();
      updateVariantHighlight();
    });
  });
  
  variantOptions.forEach(option => {
    option.addEventListener('click', function() {
      const radio = this.querySelector('input[type="radio"]');
      radio.checked = true;
      updatePrice();
      updateVariantHighlight();
    });
  });
  
  quantityInput.addEventListener('input', updatePrice);
  
  // Initialize
  updatePrice();
  updateVariantHighlight();
});
</script>

<style>
  .valentine-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 16px rgba(255, 107, 157, 0.4);
    transition: all 0.3s ease;
  }
  
  .variant-option:hover {
    border-color: #ff6b9d !important;
    box-shadow: 0 4px 8px rgba(255, 107, 157, 0.2);
    transition: all 0.3s ease;
  }
</style>

{% endblock %}