{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Watercolors By Karla{% endblock title %}

{% block content %}

<!-- Valentine's Shop Banner -->
<div class="valentine-banner" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); padding: 1rem; text-align: center; border-bottom: 2px solid #ff6b9d;">
  <p style="margin: 0; color: #8b0000; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; font-size: clamp(1rem, 2vw, 1.3rem);">
    üíï <a href="/shop/" style="color: #8b0000; text-decoration: underline;">‚Üê Back to Shop</a>
  </p>
</div>

<div class="container my-5">
  <div class="row">
    <!-- Product Image -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-lg" style="border: 3px solid #ffb3ba;">
        {% if product.image %}
          <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}" style="width: 100%; height: auto;">
        {% else %}
          <div class="text-center p-5" style="background: linear-gradient(135deg, #ffe4e6 0%, #ffc9d4 100%);">
            <span style="font-size: 5rem; color: #ff6b9d;">üé®</span>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-6">
      <div class="card shadow-lg p-4" style="border: 3px solid #ffb3ba;">
        <h1 style="font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; color: #8b0000; margin-bottom: 1rem;">
          {{ product.name }}
        </h1>

        <span class="badge mb-3" style="background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); font-size: 1rem; padding: 0.5rem 1rem;">
          {{ product.get_category_display }}
        </span>

        <p style="font-size: 1.1rem; line-height: 1.6; color: #555; margin-top: 1rem;">
          {{ product.description }}
        </p>

        {% if sizes %}
        <div class="mt-4">
          <h3 style="font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; color: #8b0000;">
            Choose Your Size:
          </h3>
          
          <form method="POST" action="{% url 'shop:add_to_cart' 0 %}".replace('0', selectedVariant) id="addToCartForm">
            {% csrf_token %}
            <div class="size-options mt-3">
              {% for size in sizes %}
              <div class="form-check mb-3 p-3" style="border: 2px solid #ffb3ba; border-radius: 8px; cursor: pointer;" onclick="selectSize({{ size.id }}, {{ size.price }})">
                <input class="form-check-input" type="radio" name="size" id="size{{ size.id }}" value="{{ size.id }}" {% if forloop.first %}checked{% endif %}>
                <label class="form-check-label w-100" for="size{{ size.id }}" style="cursor: pointer;">
                  <strong style="color: #8b0000;">{{ size.get_size_display }}</strong>
                  <span class="float-end" style="color: #c94b7d; font-size: 1.2rem;">
                    <strong>${{ size.price }}</strong>
                  </span>
                </label>
              </div>
              {% endfor %}
            </div>

            <div class="mt-4">
              <label for="quantity" class="form-label" style="font-weight: bold; color: #8b0000;">Quantity:</label>
              <input type="number" class="form-control" id="quantity" name="quantity" value="1" min="1" max="10" style="max-width: 100px; border: 2px solid #ffb3ba;">
            </div>

            <button type="submit" class="btn btn-lg mt-4 w-100" style="background: linear-gradient(135deg, #ff6b9d 0%, #c94b7d 100%); color: white; border: none; padding: 1rem; font-size: 1.2rem;">
              üõí Add to Cart - $<span id="totalPrice">{{ sizes.0.price }}</span>
            </button>
          </form>
        </div>
        {% else %}
        <div class="alert alert-warning mt-4">
          <strong>‚ö†Ô∏è No sizes available yet</strong> - Please check back soon or contact us for custom orders.
        </div>
        {% endif %}

        {% if product.featured %}
        <div class="mt-4 p-3" style="background: linear-gradient(135deg, #ffe4e6 0%, #ffc9d4 100%); border-radius: 8px; border: 2px solid #ff6b9d;">
          <p style="margin: 0; color: #8b0000; font-weight: bold;">
            ‚≠ê Featured Product - One of Karla's most popular pieces!
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  let selectedVariant = {{ sizes.0.id|default:0 }};
  
  function selectSize(variantId, price) {
    selectedVariant = variantId;
    updatePrice();
  }
  
  function updatePrice() {
    const quantity = parseInt(document.getElementById('quantity').value);
    const pricePerUnit = parseFloat(document.querySelector('input[name="size"]:checked').closest('.form-check').querySelector('strong:last-child').textContent.replace('$', ''));
    const totalPrice = (pricePerUnit * quantity).toFixed(2);
    document.getElementById('totalPrice').textContent = totalPrice;
    
    // Update form action with selected variant
    const form = document.getElementById('addToCartForm');
    form.action = "{% url 'shop:add_to_cart' 0 %}".replace('0', selectedVariant);
  }
  
  // Update price when quantity changes
  document.getElementById('quantity').addEventListener('input', updatePrice);
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    updatePrice();
  });
</script>

<!-- Valentine's Theme CSS -->
<style>
  .form-check:hover {
    background: linear-gradient(135deg, #ffe4e6 0%, #ffc9d4 100%);
    transform: translateY(-2px);
    transition: all 0.3s ease;
  }
  
  .form-check-input:checked + .form-check-label {
    color: #c94b7d;
    font-weight: bold;
  }
  
  button[type="submit"]:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 16px rgba(255, 107, 157, 0.4);
    transition: all 0.3s ease;
  }
</style>

{% endblock %}